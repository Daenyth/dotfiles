#!/usr/bin/perl
use warnings;
use strict;

my $repo = shift || 'community';
my @pkgs = `pacman -Slq $repo`;
my %sizes = (
	B => 1/1024,
	K => 1,
	M => 1024,
);
my %pkgsizes;

foreach my $pkg (@pkgs) {
	chomp $pkg;
	my ($size, $x) = `pacman -Si $pkg` =~ m/Download Size\s+:\s+(\d+\.?\d+) ([KMB])/;
	$pkgsizes{$pkg} = $size * $sizes{$x}; 
}

foreach my $pkg (sort {$pkgsizes{$b} <=> $pkgsizes{$a}} keys %pkgsizes) {
	printf "%-15.2f %s\n", $pkgsizes{$pkg}, $pkg;
}
